
<!-- form-creator.component.html -->
<div class="container mt-4">
  <!-- Header -->
  <div class="d-flex justify-content-between align-items-center mb-4">
    <h2 class="text-primary">
      <i class="fas fa-drafting-compass me-2"></i>Form Builder
    </h2>
    <button type="button" class="btn btn-success" (click)="openModal(content)">
      <i class="fas fa-eye me-2"></i>Show Live Preview
    </button>
  </div>

  <!-- Builder Section -->
  <div class="card mb-4">
    <div class="card-header  text-white">
      <h4 class="mb-0"><i class="fas fa-cog me-2"></i>Field Configuration</h4>
    </div>
    <div class="card-body">
      <form [formGroup]="dynamicForm" (ngSubmit)="submitForm()">
        <div formArrayName="fields" cdkDropList (cdkDropListDropped)="drop($event)">
          <div *ngFor="let field of sortedFields; let i = index" [formGroupName]="i" class="mb-3 border p-3 rounded"
            cdkDrag>

            <!-- Field Header -->
            <div class="d-flex align-items-center mb-3">
              <div class="drag-handle me-3" cdkDragHandle>
                <i class="fas fa-arrows-alt text-muted"></i>
              </div>
              <button type="button" class="btn btn-danger btn-sm me-3" (click)="removeField(i)">
                <i class="fas fa-trash"></i>
              </button>
              <div class="form-check form-switch me-3">
                <input class="form-check-input" type="checkbox" formControlName="required" id="required{{i}}">
                <label class="form-check-label" for="required{{i}}">Required</label>
              </div>
            </div>

            <!-- Main Configuration -->
            <div class="row g-3">
              <div class="col-md-6">
                <label class="form-label">Label</label>
                <input type="text" class="form-control" formControlName="label" placeholder="Put the Label in here" required>
              </div>

              <div class="col-md-3">
                <label class="form-label">Type</label>
                <select class="form-select" formControlName="type">
                  <option *ngFor="let type of availableFieldTypes" [value]="type">
                    {{ type }}
                  </option>
                </select>
              </div>

              <div class="col-md-3">
                <label class="form-label">Position</label>
                <div class="input-group">
                  <button class="btn btn-outline-secondary" type="button"
                    (click)="updateOrder(field, field.get('order')?.value - 1)">
                    <i class="fas fa-chevron-up"></i>
                  </button>
                  <input readonly type="number" class="form-control px-1 fs-6 text-center"
                    [formControl]="field.get('order')" min="1" [max]="fields.length">

                  <button class="btn btn-outline-secondary" type="button"
                    (click)="updateOrder(field, field.get('order')?.value + 1)">
                    <i class="fas fa-chevron-down"></i>
                  </button>
                </div>
              </div>
            </div>

            <!-- Dynamic Settings -->
            <div class="mt-3">
              <!-- Text-based Fields -->
              <div *ngIf="['text','email'].includes(field.get('type')?.value)" class="row g-3">
                <div class="col-md-6">
                  <label class="form-label">Placeholder</label>
                  <input type="text" class="form-control" formControlName="placeholder" placeholder="Put the placeholder message in here">
                </div>
                <div class="col-md-6">
                  <label class="form-label">Validation Pattern</label>
                  <input type="text" class="form-control" formControlName="regex" placeholder="Put the regex expression in here">
                </div>
              </div>
               <!-- Custom Error Message Input -->
               <div *ngIf="['text','email'].includes(field.get('type')?.value)" class="col-md-12 mt-2">
                <label class="form-label">Custom Error Message</label>
                <input type="text" class="form-control" formControlName="regexErrorMessage"
                  placeholder="Displayed when input doesn't match pattern">
              </div>

              <!-- Range Settings -->
              <div *ngIf="field.get('type')?.value === 'range'" class="row g-3">
                <div class="col-md-6">
                  <label class="form-label">Minimum</label>
                  <input type="number" class="form-control" formControlName="rangeStart">
                </div>
                <div class="col-md-6">
                  <label class="form-label">Maximum</label>
                  <input type="number" class="form-control" formControlName="rangeEnd">
                </div>
              </div>

              <!-- Select Options -->
              <div *ngIf="field.get('type')?.value === 'select'" class="mt-3">
                <label class="form-label">Options</label>
                <div formArrayName="selectOptions">
                  <div *ngFor="let opt of getSelectOptions(field).controls; let j = index" class="input-group mb-2">
                    <input type="text" class="form-control" [formControlName]="j">
                    <button type="button" class="btn btn-outline-danger" (click)="removeSelectOption(field, j)">
                      <i class="fas fa-times"></i>
                    </button>
                  </div>
                </div>
                <button type="button" class="btn btn-outline-success btn-sm mt-2" (click)="addSelectOption(field)">
                  <i class="fas fa-plus me-2"></i>Add Option
                </button>
              </div>
            </div>
          </div>
        </div>


        <div class="d-flex gap-2 mb-2 ">
          <button type="button" class="btn btn-outline-dark" (click)="addField()">
            <i class="fas fa-plus me-2"></i>Add New Field
          </button>
        </div>

        <div class="mt-4">
          <button type="submit" class="btn btn-primary me-2" (click)="send2OfferManager()">
            <i class="fas fa-save me-2"></i>Save Form
          </button>
          <button type="button" class="btn btn-outline-secondary" (click)="resetForm()">
            <i class="fas fa-undo me-2"></i>Reset
          </button>
        </div>
      </form>
    </div>
  </div>

</div>


<ng-template #content role="document" let-modal>
  <div class="modal-header bg-light">
    <h5 class="modal-title">
      <i class="fas fa-eye me-2"></i>Live Preview
    </h5>
    <button type="button" class="btn-close" aria-hidden="true" (click)="modal.dismiss('Cross click')"></button>
  </div>
  <div class="modal-body">
    <div class="card">
   
      <div class="card-body">
        <form #previewForm="ngForm">
          <div *ngFor="let field of sortedFields" class="mb-4">
            <div class="mb-3" *ngIf="field.get('type')?.value !== 'section'">
              <label class="form-label">
                {{ field.get('label')?.value || 'Unlabeled field' }}
                <span *ngIf="field.get('required')?.value" class="text-danger">*</span>
              </label>

              <ng-container [ngSwitch]="field.get('type')?.value">
                <input *ngSwitchCase="'text'" type="text" class="form-control"
                  [placeholder]="field.get('placeholder')?.value" [required]="field.get('required')?.value">

                <input *ngSwitchCase="'email'" type="email" class="form-control"
                  [placeholder]="field.get('placeholder')?.value" [required]="field.get('required')?.value">

                <input *ngSwitchCase="'date'" type="date" class="form-control"
                  [required]="field.get('required')?.value">

                <input *ngSwitchCase="'time'" type="time" class="form-control"
                  [required]="field.get('required')?.value">

                <div *ngSwitchCase="'checkbox'" class="form-check">
                  <input type="checkbox" class="form-check-input">
                </div>

                <input *ngSwitchCase="'color'" type="color" class="form-control form-control-color">

                <input *ngSwitchCase="'range'" type="range" class="form-range" [min]="field.get('rangeStart')?.value"
                  [max]="field.get('rangeEnd')?.value">

                <select *ngSwitchCase="'select'" class="form-select">
                  <option *ngFor="let opt of getSelectOptions(field).value" [value]="opt">
                    {{ opt }}
                  </option>
                </select>
              </ng-container>

              <small *ngIf="field.get('description')?.value" class="form-text text-muted">
                {{ field.get('description')?.value }}
              </small>
            </div>
          </div>
        </form>
      </div>
    </div>
  </div>
  <div class="modal-footer">
    <button type="button" class="btn btn-secondary" (click)="modal.close()">Close</button>
  </div>
</ng-template>